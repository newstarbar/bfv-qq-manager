## 🌟 功能概述

BFV 二代服管机基于初代版本优化升级，提供更完善的权限控制、服务器管理、自动播报等功能，支持通过 QQ 机器人便捷操作，详细功能可参考项目 README。

## 📋 前置环境

### 1. napcat 配置

BFV 二代服管机依赖 napcat 框架，需提前完成其配置。napcat 是现代化的基于 NTQQ 的 Bot 协议端实现，具有无需图形环境、在 Linux 上表现出色、与现有 Hook 框架有本质区别、性能与内存占用优于基于 Hook 的框架等特点。

-   **项目地址**：[NapNeko/NapCatQQ](https://github.com/NapNeko/NapCatQQ)
-   **官方文档**：[NapCat 官方文档](https://napneko.github.io) ，在文档中你可以找到详细的安装、配置指南及接口说明等，以帮助你顺利完成 napcat 的配置工作。
-   **下载方式**：若你使用 Windows 系统，可从 [NapCatQQ Releases](https://github.com/NapNeko/NapCatQQ/releases/latest/download/napcat.shell.windows.onekey.zip) 。下载一键安装包并解压 。解压后进入文件夹，双击运行 `napcat installer.exe` ，程序会自动下载 QQ 及相关文件。完成上述步骤后，会在当前文件夹生成一个类似 `napcat.34740.shell` （中间数字可能变化）的文件夹，进入该文件夹后续进行相关配置操作。
-   **配置示例**：配置完成后，确保 BFV 二代服管机配置文件中的 `ws_ip` 、`ws_token` 、`http_ip` 、`http_token` 与 napcat 配置保持一致（在 BFV 二代服管机配置文件中这几项默认值一般无需修改，若你对 napcat 进行了特殊配置导致这几项需更改，请务必对应调整）。如：

```json
{
	"ws_ip": "127.0.0.1:3001", // 需与napcat配置对应
	"ws_token": "napcat", // 与napcat配置一致
	"http_ip": "127.0.0.1:3000", // 需与napcat配置对应
	"http_token": "napcat" // 与napcat配置一致
}
```

-   **注意事项**：在配置 napcat 过程中，请严格按照官方文档指引操作。若配置不当，可能导致 BFV 二代服管机无法正常运行。如遇问题，可参考官方文档中的常见问题解答部分，或在 napcat 的 GitHub 项目页面查看是否有相关讨论及解决方案 。

### 2. BFV ROBOT 社区第三方平台绑定

该依赖与社区机器人交互及功能使用相关，需完成账号绑定，涉及 QQ、KOOK、QQ Open ID 的绑定。

-   **详细指南**：[BFV ROBOT 社区用户第三方平台绑定指南](https://zth.ink/?p=558)
-   **QQ 绑定流程**：参考[QQ 绑定相关原文](https://forum.bfvrobot.net/t/topic/625)，当前仅支持 QQ 邮箱验证。点击绑定/解绑按钮，选择 QQ 邮箱验证，完成人机验证后，到 QQ 邮箱点击邮件链接即可完成；若无法访问原有 QQ 号，可联系社区成员协助解绑。
-   **QQ Open ID 获取与绑定**：参考[QQ Open ID 相关原文](https://forum.bfvrobot.net/t/topic/681)。Open ID 是腾讯为保护用户隐私提供的官方 QQ 账户唯一标识，获取需使用 RunRun 机器人（ROBOT 团队唯一指定官方机器人），在单聊中输入`/bind`指令。绑定流程为：获取 Open ID 后，登录 ROBOT 官网，在个人界面第三方账户区域点击绑定，填入 Open ID 并完成人机验证，再到 RunRun 机器人私聊对话中输入`/bindVerify`指令完成绑定。
-   **补充说明**：部分指令需绑定社区用户后使用，绑定方式可参考[BFV ROBOT 社区公共 QQ 机器人食用指南](https://zth.ink/?p=572)中的 QQ OpenID 绑定部分。可通过扫码或链接与 RunRun 机器人私信，机器人可添加到群聊使用，但需规范操作，避免滥用被屏蔽。

## 📦 下载与安装

1. 下载[V2 前置环境依赖](https://github.com/newstarbar/bfv-qq-manager/releases/tag/v2) [windows](https://github.com/newstarbar/bfv-qq-manager/releases/download/v2/Win-Configure.zip) 或 [linux](https://github.com/newstarbar/bfv-qq-manager/releases/download/v2/Linux-Configure.tar) 并解压到程序同级目录
2. 下载最新版本的 `bfv-manager-win.exe` 或 `bfv-manager-linux.sh` 并放置在程序同级目录
3. 下载最新版本的 `data-statistics-win.exe` 或 `data-statistics-linux.sh` 并放置在程序同级目录(注意：推荐`bfv-manager.*`部署在国内云服务器，`data-statistics.*`部署在国外服务器，使用同一环境依赖即可)
4. 运行 `bfv-manager-win.exe` 或 `bfv-manager-linux.sh` 启动程序
5. 运行 `data-statistics-win.exe` 或 `data-statistics-linux.sh` 启动数据统计程序(如果改程序与上一步不是同一台机器，请修改配置文件中的 `data_statistics_ip` 项，并运行[开放端口脚本](https://github.com/newstarbar/bfv-qq-manager/blob/main/doc/开启dataStatistics服务端口.bat), 如果是云服务器的话，在安全组中开放 7639 端口)
6. 按照提示完成配置，并等待程序启动完成

## 🔧 环境配置

### 1. 生图模块环境部署

-   将 `chrome.zip` 放置在 `bfv-manager-win.exe` 或 `bfv-manager-linux.sh` 同级文件夹
-   解压得到 `chrome` 文件夹，确保目录结构如下：
    ```
    BFVQQ服管系统.exe
    chrome/
    └── win/
        └── chrome.exe
    ```
-   注意：此文件为固定环境配置，后续版本更新无需改动

### 2. 核心配置文件修改

找到程序同级目录的配置文件（通常为 `config.json` 或类似名称），按以下说明修改：

```json
{
	"status_ip": "127.0.0.1:7639", // 服务器玩家对局战绩查询接口
	"status_token": "zygo", // 服务器玩家对局战绩查询接口token（如果部署在外部服务器，请修改，勿泄露）
	"ws_ip": "127.0.0.1:3001", // 请勿修改
	"ws_token": "napcat", // 与napcat配置一致，请勿修改
	"http_ip": "127.0.0.1:3000", // 请勿修改
	"http_token": "napcat", // 与napcat配置一致，请勿修改
	"bot_name": "服管机器人", // 自定义机器人QQ昵称（踢人时显示）
	"bot_qq": "", // 填写机器人QQ号（需完成验证）
	"admin_qq": "", // 填写超级管理员QQ号（用于初始化群聊，必填！）
	"group_name": "", // 填写群组名称（需完成验证）
	"ai_token": "" // 填写AI模块token（获取地址：https://cloud.siliconflow.cn/i/wIXurGHa）
    "ai_model": "Qwen/Qwen2.5-7B-Instruct" // 填写AI模型名称（获取地址：https://cloud.siliconflow.cn/me/models）
}
```

## 🚀 初次使用流程

1. **初始化群聊**  
   在大群内发送 `init` 命令，完成群聊初始化

2. **刷新群成员数据库**  
   发送 `update` 命令，自动识别群成员头衔并分配初始权限：

    - 头衔含「督战队」→ 1 级管理员
    - 头衔含「都督」→ 2 级管理员
    - 头衔含「总督」「群主」「服主」→ 3 级管理员
    - 配置文件中 `admin_qq` 对应账号 → 4 级超级管理员（唯一）

3. **手动设置管理员权限**  
   发送命令 `admin=QQ号 权限等级`（如 `admin=123456 1`），设置后需再次发送 `update` 生效

4. **Cookie 管理**

    - 超管绑定他人 Cookie：发送 `cookie=EAID QQ号 SID`
    - 管理员私聊机器人可更新自身 Cookie：发送 `sid=具体Cookie[SID]`
    - Cookie 过期时，机器人会自动私聊提醒

5. **设置 EA 查询主账号**  
   发送 `main=EAID` 指定主账号（⚠️ 强烈建议使用开通 EA 密钥的红信账号，降低风险）

## ⚠️ 重要风险提示

-   程序调用频率较高，**主 EA 查询账号存在被 EA 封禁的未知风险**，请谨慎选择账号
-   建议使用开通 EA 密钥的红信账号作为主查询账号，勿使用个人常用账号
-   任何账号封禁问题，由用户自行承担责任
-   非主查询账号的 Cookie 仅用于播报系统，风险较低
