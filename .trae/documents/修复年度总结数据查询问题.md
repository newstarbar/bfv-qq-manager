# 修复年度总结数据查询问题

## 问题分析
根据代码分析，年度总结功能中所有数据都没有显示的可能原因包括：
1. 数据库文件不存在或无法访问
2. 查询条件过严格，特别是时间范围限制
3. 表名或字段名与实际数据库不一致
4. 缺乏详细日志，难以定位问题

## 解决方案
### 1. 添加详细日志记录
- 在每个查询前后添加日志，记录查询语句、参数和结果
- 使用logger工具替代console.error，统一日志管理
- 记录查询结果的数量和具体内容

### 2. 简化查询条件
- 暂时移除时间范围限制，测试基本查询是否正常工作
- 逐步添加查询条件，定位具体问题

### 3. 添加数据库和表存在性检查
- 在打开数据库前检查文件是否存在
- 添加表存在性验证，确保查询的表确实存在
- 为每个数据库添加连接状态检查

### 4. 验证表名和字段名
- 检查所有查询中使用的表名和字段名是否与实际数据库一致
- 特别注意weapons、vehicles、gadgets等关联表的结构

### 5. 优化错误处理
- 为每个查询添加独立的错误处理
- 记录详细的错误信息，包括错误类型、查询语句和参数

## 实施步骤
1. 修改`src/robot/cx/annualSummary.ts`文件
   - 添加数据库文件存在性检查
   - 为每个查询添加详细日志
   - 简化查询条件，暂时移除时间范围限制
   - 添加表存在性验证
   - 优化错误处理

2. 测试修复效果
   - 运行年度总结功能，查看日志输出
   - 逐步恢复查询条件，定位具体问题
   - 确保所有数据都能正确显示

3. 最终优化
   - 恢复时间范围限制
   - 确保所有查询都能正确执行
   - 清理不必要的日志，保留关键信息

## 预期效果
- 年度总结功能能够正确显示所有数据
- 详细的日志记录，便于调试和维护
- 完善的错误处理，防止程序崩溃
- 优化的查询逻辑，提高性能

通过以上修复，年度总结功能的数据查询问题将得到解决，所有数据都能正确显示。